function dataReady(t,e,r,a){if(t)throw t;_crime=a,_cities=e,_states=r,e.map(function(t){var e=a.find(function(e){return t.NAME===e.city});return e&&(t.pop_2014=e.pop_2014,t.pop_1950=e.pop_1950,t.murder_rate=e.murder),t}),renderMap(_cities,_states,_crime)}function drawMapCircles(t){var e=svg.selectAll("circle").data(t).enter().append("g").attr("transform",function(t){return"translate("+projection([t.longitude,t.latitude])+")"}).attr("class","city");e.append("circle").style("fill","#820505").attr("r",function(t){return t.murder_rate?.8*Math.round(t.murder_rate):0}).append("title").text(function(t){return t.NAME+"\nMurders: "+Math.round(t.murder_rate)+" for every 100k\n2014 Population: "+t.pop_2014+"\n1950 Population: "+t.pop_1950})}function renderMap(t,e,r){svg.selectAll("*").remove(),t=t.filter(function(t){return projection([t.longitude,t.latitude])}),svg.selectAll(".states").data(topojson.feature(e,e.objects.states).features).enter().append("path").attr("class","states").attr("d",path),drawMapCircles(t)}var svg=d3.select(".svg-container").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1").attr("viewBox","0 0 900 500").attr("preserveAspectRatio","xMidYMid meet"),projection=d3.geoAlbersUsa(),path=d3.geoPath().projection(projection);d3.queue().defer(d3.csv,"../cities-over-250k.csv").defer(d3.json,"../us-states-simplified.json").defer(d3.csv,"crime-in-us.csv").await(dataReady);var _cities={},_states={},_crime={};