function dataReady(e,t,r,a){if(e)throw e;_crime=a,_cities=t,_states=r,t.map(function(e){var t=a.find(function(t){return e.NAME===t.city});return t&&(e.pop_2015=t.pop_2015,e.murder=t.murder,e.murder_rate=t.murder_rate),e}),renderMap(_cities,_states,_crime)}function drawMapCircles(e){var t=svg.selectAll("circle").data(e).enter().append("g").attr("transform",function(e){return"translate("+projection([e.longitude,e.latitude])+")"}).attr("class","city");t.append("circle").style("fill","#820505").style("stroke","grey").style("fill-opacity",.8).attr("r",function(e){return console.log(e.NAME+","+Math.round(e.murder_rate)),e.murder_rate?e.murder_rate:0}).on("mouseover",function(){var e=d3.select(this).text();d3.select("#panel").text(e)}).append("title").text(function(e){return e.NAME+" -\nMurders: "+e.murder+" ("+ +Math.round(e.murder_rate)+" for every 100k),\n2015 Population: "+e.pop_2015})}function renderMap(e,t,r){svg.selectAll("*").remove(),e=e.filter(function(e){return projection([e.longitude,e.latitude])}),svg.selectAll(".states").data(topojson.feature(t,t.objects.states).features).enter().append("path").attr("class","states").attr("d",path),drawMapCircles(e)}var svg=d3.select(".svg-container").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1").attr("viewBox","0 0 900 500").attr("preserveAspectRatio","xMidYMid meet"),projection=d3.geoAlbersUsa(),path=d3.geoPath().projection(projection);d3.queue().defer(d3.csv,"../cities-over-250k.csv").defer(d3.json,"../us-states-simplified.json").defer(d3.csv,"crime-in-us-2015.csv").await(dataReady);var _cities={},_states={},_crime={};