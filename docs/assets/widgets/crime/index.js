function dataReady(t,e,r,a){if(t)throw t;_crime=a,_cities=e,_states=r,e.map(function(t){var e=a.find(function(e){return t.NAME===e.city});return e&&(t.pop=e.pop,t.murder=e.murder,t.murder_rate=e.murder_rate),t}),renderMap(_cities,_states,_crime)}function drawMapCircles(t){svg.selectAll("circle").data(t).enter().append("g").attr("transform",function(t){return"translate("+projection([t.longitude,t.latitude])+")"}).attr("class","city").append("circle").style("fill",function(t){return colorScale(t.murder_rate)}).style("stroke","grey").style("fill-opacity",.8).attr("r",function(t){return t.murder_rate?.5*t.murder_rate:0}).on("mouseover",tip.show).on("mouseout",tip.hide)}function renderMap(t,e,r){svg.selectAll("*").remove(),t=t.filter(function(t){return projection([t.longitude,t.latitude])}),svg.selectAll(".states").data(topojson.feature(e,e.objects.states).features).enter().append("path").attr("class","states").attr("d",path),drawMapCircles(t)}var tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t.NAME+": "+t.murder+" ("+Math.round(t.murder_rate)+" per 100k)<div>2016 Population: "+t.pop+"</div>"}),svg=d3.select(".svg-container").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1").attr("viewBox","0 0 900 500").attr("preserveAspectRatio","xMidYMid meet");svg.call(tip);var projection=d3.geoAlbersUsa(),path=d3.geoPath().projection(projection),colorScale=d3.scaleThreshold().domain([1,4,8,15,20,30,40,50,60]).range(["rgb(255,245,240)","rgb(254,224,210)","rgb(252,187,161)","rgb(252,146,114)","rgb(251,106,74)","rgb(239,59,44)","rgb(203,24,29)","rgb(165,15,21)","rgb(103,0,13)"]);d3.queue().defer(d3.csv,"../cities-over-250k.csv").defer(d3.json,"../us-states-simplified.json").defer(d3.csv,"crime-in-us-2016.csv").await(dataReady);var _cities={},_states={},_crime={};