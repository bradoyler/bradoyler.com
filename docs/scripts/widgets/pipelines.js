function dataReady(e,t,s,r,a){if(e)throw e;_crude=t,_cities=s,_states=r,_petro=a,renderMap(_crude,_cities,_states)}function renderMap(e,t,s,r){svg.selectAll("*").remove();var a=e.objects.CrudeOil_Pipelines_US_201606;if(svg.selectAll(".states").data(topojson.feature(s,s.objects.states).features).enter().append("path").attr("class","states").attr("d",path),svg.selectAll(".pipelines").data(topojson.feature(e,a).features).enter().append("path").attr("class","pipelines").attr("d",path).on("mouseover touchstart",function(e){d3.select("#panel").html(e.properties.Opername+" - "+e.properties.Pipename+" (Crude)"),d3.selectAll(".highlight").attr("class","pipelines"),d3.select(this).attr("class","highlight")}),r){var o=r.objects.PetroleumProduct_Pipelines_US_201606;svg.selectAll(".petro_pipelines").data(topojson.feature(r,o).features).enter().append("path").attr("class","petro_pipelines").attr("d",path).on("mouseover touchstart",function(e){d3.select("#panel").html(e.properties.Opername+" - "+e.properties.Pipename+" (Petro)"),d3.selectAll(".highlight_orange").attr("class","petro_pipelines"),d3.select(this).attr("class","highlight_orange")})}svg.append("path").datum(topojson.feature(t,t.objects.cities)).attr("d",path).attr("class","city"),svg.selectAll(".city-label").data(topojson.feature(t,t.objects.cities).features).enter().append("text").attr("class","city-label").attr("transform",function(e){return"translate("+projection(e.geometry.coordinates)+")"}).attr("dy",".70em").attr("dx",".50em").text(function(e){return e.properties.NAME})}var svg=d3.select(".svg-container").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1").attr("viewBox","0 0 900 500").attr("preserveAspectRatio","xMidYMid meet"),projection=d3.geoAlbersUsa(),path=d3.geoPath().projection(projection);d3.queue().defer(d3.json,"CrudeOil_Pipelines_US_201606.json").defer(d3.json,"us-major-cities.json").defer(d3.json,"us-states-simplified.json").defer(d3.json,"PetroleumProduct_Pipelines_US_201606.json").await(dataReady);var _crude={},_cities={},_states={},_petro={};$("#showPetro").on("click",function(e){var t=$(this)[0].checked;t?renderMap(_crude,_cities,_states,_petro):renderMap(_crude,_cities,_states)});