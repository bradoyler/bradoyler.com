function dataReady(e,t,r,s,a){if(e)throw e;_crude=t,_cities=r,_states=s,_petro=a,renderMap(_crude,_cities,_states)}function renderMap(e,t,r,s){svg.selectAll("*").remove();var a={"CENTURION PIPELINE":"#7570b3","PLAINS PIPELINE":"#e7298a","PHILLIPS 66 PIPELINE":"#666666","KOCH PIPELINE":"#d95f02",EXXONMOBIL:"#377eb8","EXXONMOBIL WEST COAST":"#377eb8",SHELL:"#e41a1c",SUNOCO:"#ffff33",ENBRIDGE:"#4daf4a",ENTERPRISE:"#a65628",other:"#000"},o=e.objects.CrudeOil_Pipelines_US_201606;if(o.geometries.sort(function(e,t){return e.properties.Opername<t.properties.Opername?-1:e.properties.Opername>t.properties.Opername?1:0}),svg.selectAll(".states").data(topojson.feature(r,r.objects.states).features).enter().append("path").attr("class","states").attr("d",path),svg.selectAll(".pipelines").data(topojson.feature(e,o).features).enter().append("path").attr("class","pipelines").attr("d",path).style("stroke",function(e){return console.log(e.properties.Opername),a[e.properties.Opername]||a.other}).on("mouseover touchstart",function(e){var t=a[e.properties.Opername]||a.other,r='<span class="glyphicon glyphicon-oil" style="color:'+t+'"></span> '+e.properties.Opername+" - "+e.properties.Pipename+" (Crude)";d3.select("#panel").html(r),d3.selectAll(".highlight").attr("class","pipelines"),d3.select(this).attr("class","highlight")}),s){var p=s.objects.PetroleumProduct_Pipelines_US_201606;svg.selectAll(".petro_pipelines").data(topojson.feature(s,p).features).enter().append("path").attr("class","petro_pipelines").attr("d",path).on("mouseover touchstart",function(e){d3.select("#panel").html(e.properties.Opername+" - "+e.properties.Pipename+" (Petro)"),d3.selectAll(".highlight_orange").attr("class","petro_pipelines"),d3.select(this).attr("class","highlight_orange")})}svg.append("path").datum(topojson.feature(t,t.objects.cities)).attr("d",path).attr("class","city"),svg.selectAll(".city-label").data(topojson.feature(t,t.objects.cities).features).enter().append("text").attr("class","city-label").attr("transform",function(e){return"translate("+projection(e.geometry.coordinates)+")"}).attr("dy",".70em").attr("dx",".50em").text(function(e){return e.properties.NAME})}var svg=d3.select(".svg-container").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1").attr("viewBox","0 0 900 500").attr("preserveAspectRatio","xMidYMid meet"),projection=d3.geoAlbersUsa(),path=d3.geoPath().projection(projection);d3.queue().defer(d3.json,"CrudeOil_Pipelines_US_201606.json").defer(d3.json,"us-major-cities.json").defer(d3.json,"us-states-simplified.json").defer(d3.json,"PetroleumProduct_Pipelines_US_201606.json").await(dataReady);var _crude={},_cities={},_states={},_petro={};$("#showPetro").on("click",function(e){$(this)[0].checked?renderMap(_crude,_cities,_states,_petro):renderMap(_crude,_cities,_states)});